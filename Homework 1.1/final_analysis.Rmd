---
title: "final_analysis"
output:
  html_document:
    df_print: paged
---


```{r}
library(ggplot2)
library(ggpubr)
library(plyr)
library(lubridate)
library(dplyr)
library(scales)
library(gridExtra)
```

> LOAD DATA

```{r}
movies <- get(load("movies.RData"))
```

```{r}
head(movies)
```

```{r}
summary(movies)
```

> TRANSFORM DATA

```{r}
#Runtime:
movies[!complete.cases(movies['runtime']),]
movies$runtime[movies$title == "The End of America"] <- 74
#https://www.imdb.com/title/tt1294790/

#Director:
movies$director[movies$title == "Lorenzo's Oil"] <- "George Miller"
#https://es.wikipedia.org/wiki/Lorenzo%27s_Oil_(pel%C3%ADcula)
movies$director[movies$title == "The Ninth Gate"] <- "Roman Polanski"
#https://es.wikipedia.org/wiki/The_Ninth_Gate

#Studio:
movies$studio <- as.character(movies$studio)
movies$studio[movies$title == "Oliver & Company"] <-
  "Walt Disney Pictures"
#https://es.wikipedia.org/wiki/Oliver_y_su_pandilla
movies$studio[movies$title == "Attack of the 50 Foot Woman"] <-
  "Woolner Brothers Pictures Inc."
#https://www.imdb.com/title/tt0051380/
movies$studio[movies$title == "Inbred"] <- "Melanie Light"
#https://www.imdb.com/title/tt1723124/fullcredits
movies$studio[movies$title == "Caveman"] <- "United Artists"
#https://es.wikipedia.org/wiki/El_cavern%C3%ADcola
movies$studio[movies$title == "Dirty Sanchez: The Movie"] <-
  "Vertigo Films"
#https://www.rottentomatoes.com/m/dirty_sanchez
movies$studio[movies$title == "The Man Who Sued God"] <-
  "Australian Film Finance Corporation (AFFC), New South Wales Film & Television Office, Showtime Australia See more"
#https://www.imdb.com/title/tt0268437/
movies$studio[movies$title == "Inserts"] <-
  "Film and General Productions"
#https://www.filmaffinity.com/es/film740308.html
movies$studio <- factor(movies$studio)

#DVD realease date
movies[!complete.cases(movies['dvd_rel_year']), ]
movies$dvd_rel_year[movies$title == "Charlie: The Life and Art of Charles Chaplin"] <-
  2003
movies$dvd_rel_month[movies$title == "Charlie: The Life and Art of Charles Chaplin"] <-
  11
movies$dvd_rel_day[movies$title == "Charlie: The Life and Art of Charles Chaplin"] <-
  5
#https://www.imdb.com/title/tt0379730/releaseinfo
movies$dvd_rel_year[movies$title == "The Squeeze"] <- 2015
movies$dvd_rel_month[movies$title == "The Squeeze"] <- 6
movies$dvd_rel_day[movies$title == "The Squeeze"] <- 9
#https://medium.com/@releasebandyal/producer-michael-doven-announces-release-of-the-squeeze-on-dvd-75a982d0a047
movies$dvd_rel_year[movies$title == "Electric Dreams"] <- 1984
#https://en.wikipedia.org/wiki/Electric_Dreams_(film)
movies$dvd_rel_year[movies$title == "The Last Remake of Beau Geste"] <-
  2010
movies$dvd_rel_month[movies$title == "The Last Remake of Beau Geste"] <-
  1
movies$dvd_rel_day[movies$title == "The Last Remake of Beau Geste"] <-
  11
#https://en.wikipedia.org/wiki/The_Last_Remake_of_Beau_Geste

#Actors:
movies[!complete.cases(movies['actor4']), ]
movies$actor4[movies$title == "Attack of the 50 Foot Woman"] <-
  "Roy Gordon"
#https://www.imdb.com/title/tt0051380/fullcredits/?ref_=tt_ov_st_sm

movies[!complete.cases(movies['actor5']), ]
movies$actor5[movies$title == "Attack of the 50 Foot Woman"] <-
  "George Douglas"
#https://www.imdb.com/title/tt0051380/fullcredits/?ref_=tt_ov_st_sm
movies$actor5[movies$title == "The Illusionist (L'illusionniste)"] <-
  "Eleanor Tomlinson"
#https://en.wikipedia.org/wiki/The_Illusionist_(2006_film)


#Column manipulation
movies$thtr_rel_date <- as.Date(paste0(movies$thtr_rel_year, "-", movies$thtr_rel_month, "-", movies$thtr_rel_day))
movies$dvd_rel_date <- as.Date(paste0(movies$dvd_rel_year, "-", movies$dvd_rel_month, "-", movies$dvd_rel_day))

movies$thtr_rel_decade <- as.numeric(format(movies$thtr_rel_date,"%Y")) - (as.numeric(format(movies$thtr_rel_date,"%Y")) %% 10)
movies$thtr_rel_decade <- as.factor(movies$thtr_rel_decade)

movies$top200_box <- NULL

movies$dvd_rel_day <- NULL
movies$dvd_rel_month <- NULL
movies$dvd_rel_year <- NULL

#movies$thtr_rel_day <- NULL
#movies$thtr_rel_month <- NULL
#movies$thtr_rel_year <- NULL

movies$imdb_url <- NULL
movies$rt_url <- NULL

```

```{r}
head(movies)
```

```{r}
summary(movies)
```


# SDA Homework 1.1

We chose the "Films" dataset and we are going to answer the following questions that we thought were interesting.

  
### 1. Is there a relationship between the type/genre and score?
### 2. Comparing different scores (critics/audience/imdb)
	* is there any difference on the audience/critics score by genre?
	
### 3. Comparison best picture/oscar wins and score/oscar wins
	* are oscar-awarded films more liked?
	
### 4. What are the trends over the years?
	* Preferred month for releases? number of films by month (over the years? does it affect the score?)
	* Does the genre change over the years?
	* Do older films tend to have higher score/number of votes? if this is true, it could be because only good old films get remembered
	
### 5. Do actors and directors have a higher score once they won? (find the first film and see the tendency, look for sudden change)

------

## 1. Is there a relationship between the type/genre and score?

```{r}
g1 <- ggplot(data=movies, aes(x=audience_score)) + geom_histogram(bins=30, aes(fill = title_type), position = "identity", alpha = 0.7) + scale_color_manual(values = c("#00AFBB", "#E7B800", "#0AFBB0")) + scale_fill_manual(values = c("#00AFBB", "#E7B800", "#0AFBB0")) + theme(legend.position = "none")

g2 <- ggplot(data=movies, aes(x=critics_score)) + geom_histogram(bins=30, aes(fill = title_type), position = "identity", alpha = 0.7) + scale_color_manual(values = c("#00AFBB", "#E7B800", "#0AFBB0")) + scale_fill_manual(values = c("#00AFBB", "#E7B800", "#0AFBB0")) + theme(legend.position = "none")

g3 <- ggplot(data=movies, aes(x=imdb_rating)) + geom_histogram(bins=30, aes(fill = title_type), position = "identity", alpha = 0.7) + scale_color_manual(values = c("#00AFBB", "#E7B800", "#0AFBB0")) + scale_fill_manual(values = c("#00AFBB", "#E7B800", "#0AFBB0"))

ggarrange(
    g1,
    g2,
    g3,
    ncol = 3,
    nrow = 1,
    widths = c(200,200,400),
    labels = c("1", "2", "3")
  )
```

```{r}
g1 <- ggplot(data=movies, aes(x=audience_score)) + geom_density(aes(color = title_type), kernel = "gaussian")
g2 <- ggplot(data=movies, aes(x=critics_score)) + geom_density(aes(color = title_type), kernel = "gaussian")
g3 <- ggplot(data=movies, aes(x=imdb_rating)) + geom_density(aes(color = title_type), kernel = "gaussian")

ggarrange(
    g1,
    g2,
    g3,
    ncol = 3,
    nrow = 1,
    widths = c(200,200,400)
  )
```


```{r}
ggplot(data=movies, aes(x = reorder(genre, audience_score, median, order=TRUE), y = audience_score, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw() + coord_flip()
```

```{r}
ggplot(data=movies, aes(x = reorder(genre, critics_score, median, order=TRUE), y = critics_score, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw() + coord_flip()
```

```{r}
ggplot(data=movies, aes(x = reorder(genre, imdb_rating, median, order=TRUE), y = imdb_rating, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw() + coord_flip()
```



## 2. Comparing different scores (critics/audience/imdb)
	### - is there any difference on the audience/critics score by genre?

```{r}
score = list();

score$genre_score_agg = list(
  "critics" = aggregate(critics_score ~ genre , movies, mean),
  "audience" = aggregate(audience_score ~ genre, movies, mean),
  "imdb" = aggregate(imdb_rating ~ genre, movies, mean)
)


score$genre_metrics_grid = expand.grid(year =sort(unique(movies$genre)),
                                       metrics = c("Critic", "Audience", "IMDB"))

score$genre_metrics_grid$genre_score_agg =c(score$genre_score_agg$critics$critics_score,
                                            score$genre_score_agg$audience$audience_score, 
                                            score$genre_score_agg$imdb$imdb_rating)

score$genre_metrics_grid$genre_score_agg_rescaled = 
  c(
    rescale(score$genre_score_agg$critics$critics_score, from=(c(1,100))), 
    rescale(score$genre_score_agg$audience$audience_score, from=(c(1,100))), 
    rescale(score$genre_score_agg$imdb$imdb_rating, from=(c(1,10))))

ggplot(score$genre_metrics_grid)+
  geom_tile(aes(x=metrics, y=year,fill=genre_score_agg_rescaled))+
  scale_fill_distiller( limits=c(0,1), palette = "RdPu") 
```

```{r}
plot_number_movies_per_genre <-
  qplot(movies$genre, fill = movies$genre) + theme(legend.position = "none",
                                                   axis.text.x = element_text(angle = 45, hjust = 1)) + ggtitle("Number of movies per     genre") +
  xlab("Genre") + ylab("Number of movies")


mean_score <-
  data.frame(
    "Score" = c(
      mean(movies$imdb_rating)*10,
      mean(movies$audience_score),
      mean(movies$critics_score)
    ),
    "Source" = c("IMDB", "Audience", "Critics")
  )

plot_all <- ggplot(mean_score) + geom_linerange(aes(
  x = Source,
  ymin = 0,
  ymax = Score,
  colour = Source
),
position = position_dodge(width = 1)) +  geom_point(
  aes(x = Source, y = Score, colour = Source),
  position = position_dodge(width = 1),
  size = 3
) + coord_flip() + theme(legend.position = "none") + ggtitle("All genres")

#Action and adventure
action_adventure <- subset(movies, genre == "Action & Adventure")
mean_score <-
  data.frame(
    "Score" = c(
      mean(action_adventure$imdb_rating)*10,
      mean(action_adventure$audience_score),
      mean(action_adventure$critics_score)
    ),
    "Source" = c("IMDB", "Audience", "Critics")
  )

plot_action <- ggplot(mean_score) + geom_linerange(aes(
  x = Source,
  ymin = 0,
  ymax = Score,
  colour = Source
),
position = position_dodge(width = 1)) +  geom_point(
  aes(x = Source, y = Score, colour = Source),
  position = position_dodge(width = 1),
  size = 3
) + coord_flip() + theme(legend.position = "none") + ggtitle("Action & Adventure")

#Animation
animation <- subset(movies, genre == "Animation")
mean_score <-
  data.frame(
    "Score" = c(
      mean(animation$imdb_rating)*10,
      mean(animation$audience_score),
      mean(animation$critics_score)
    ),
    "Source" = c("IMDB", "Audience", "Critics")
  )

plot_animation <- ggplot(mean_score) + geom_linerange(aes(
  x = Source,
  ymin = 0,
  ymax = Score,
  colour = Source
),
position = position_dodge(width = 1)) +  geom_point(
  aes(x = Source, y = Score, colour = Source),
  position = position_dodge(width = 1),
  size = 3
) + coord_flip() + theme(legend.position = "none") + ggtitle("Animation")

#Art House & International
art_house <- subset(movies, genre == "Art House & International")

mean_score <-
  data.frame(
    "Score" = c(
      mean(art_house$imdb_rating)*10,
      mean(art_house$audience_score),
      mean(art_house$critics_score)
    ),
    "Source" = c("IMDB", "Audience", "Critics")
  )

plot_art_house <- ggplot(mean_score) + geom_linerange(aes(
  x = Source,
  ymin = 0,
  ymax = Score,
  colour = Source
),
position = position_dodge(width = 1)) +  geom_point(
  aes(x = Source, y = Score, colour = Source),
  position = position_dodge(width = 1),
  size = 3
) + coord_flip() + theme(legend.position = "none") + ggtitle("Art House & International")

#Comedy
comedy <- subset(movies, genre == "Comedy")

mean_score <-
  data.frame(
    "Score" = c(
      mean(comedy$imdb_rating)*10,
      mean(comedy$audience_score),
      mean(comedy$critics_score)
    ),
    "Source" = c("IMDB", "Audience", "Critics")
  )
plot_comedy <- ggplot(mean_score) + geom_linerange(aes(
  x = Source,
  ymin = 0,
  ymax = Score,
  colour = Source
),
position = position_dodge(width = 1)) +  geom_point(
  aes(x = Source, y = Score, colour = Source),
  position = position_dodge(width = 1),
  size = 3
) + coord_flip() + theme(legend.position = "none") + ggtitle("Comedy")

#Documentary
documentary <- subset(movies, genre == "Documentary")

mean_score <-
  data.frame(
    "Score" = c(
      mean(documentary$imdb_rating)*10,
      mean(documentary$audience_score),
      mean(documentary$critics_score)
    ),
    "Source" = c("IMDB", "Audience", "Critics")
  )

plot_documentary <- ggplot(mean_score) + geom_linerange(aes(
  x = Source,
  ymin = 0,
  ymax = Score,
  colour = Source
),
position = position_dodge(width = 1)) +  geom_point(
  aes(x = Source, y = Score, colour = Source),
  position = position_dodge(width = 1),
  size = 3
) + coord_flip() + theme(legend.position = "none") + ggtitle("Documentary")

#Drama
drama <- subset(movies, genre == "Drama")

mean_score <-
  data.frame(
    "Score" = c(
      mean(drama$imdb_rating)*10,
      mean(drama$audience_score),
      mean(drama$critics_score)
    ),
    "Source" = c("IMDB", "Audience", "Critics")
  )

plot_drama <- ggplot(mean_score) + geom_linerange(aes(
  x = Source,
  ymin = 0,
  ymax = Score,
  colour = Source
),
position = position_dodge(width = 1)) +  geom_point(
  aes(x = Source, y = Score, colour = Source),
  position = position_dodge(width = 1),
  size = 3
) + coord_flip() + theme(legend.position = "none") + ggtitle("Drama")

#Horror
horror <- subset(movies, genre == "Horror")

mean_score <-
  data.frame(
    "Score" = c(
      mean(horror$imdb_rating)*10,
      mean(horror$audience_score),
      mean(horror$critics_score)
    ),
    "Source" = c("IMDB", "Audience", "Critics")
  )

plot_horror <- ggplot(mean_score) + geom_linerange(aes(
  x = Source,
  ymin = 0,
  ymax = Score,
  colour = Source
),
position = position_dodge(width = 1)) +  geom_point(
  aes(x = Source, y = Score, colour = Source),
  position = position_dodge(width = 1),
  size = 3
) + coord_flip() + theme(legend.position = "none") + ggtitle("Horror")

#Musical & Performing Arts
musical <- subset(movies, genre == "Musical & Performing Arts")

mean_score <-
  data.frame(
    "Score" = c(
      mean(musical$imdb_rating)*10,
      mean(musical$audience_score),
      mean(musical$critics_score)
    ),
    "Source" = c("IMDB", "Audience", "Critics")
  )

plot_musical <- ggplot(mean_score) + geom_linerange(aes(
  x = Source,
  ymin = 0,
  ymax = Score,
  colour = Source
),
position = position_dodge(width = 1)) +  geom_point(
  aes(x = Source, y = Score, colour = Source),
  position = position_dodge(width = 1),
  size = 3
) + coord_flip() + theme(legend.position = "none") + ggtitle("Musical & Performing Arts")

#Mystery & Suspense
mistery <- subset(movies, genre == "Mystery & Suspense")
mean_score <-
  data.frame(
    "Score" = c(
      mean(mistery$imdb_rating)*10,
      mean(mistery$audience_score),
      mean(mistery$critics_score)
    ),
    "Source" = c("IMDB", "Audience", "Critics")
  )

plot_mistery <- ggplot(mean_score) + geom_linerange(aes(
  x = Source,
  ymin = 0,
  ymax = Score,
  colour = Source
),
position = position_dodge(width = 1)) +  geom_point(
  aes(x = Source, y = Score, colour = Source),
  position = position_dodge(width = 1),
  size = 3
) + coord_flip() + theme(legend.position = "none") + ggtitle("Mistery & Suspense")

#Other
other <- subset(movies, genre == "Other")

mean_score <-
  data.frame(
    "Score" = c(
      mean(other$imdb_rating)*10,
      mean(other$audience_score),
      mean(other$critics_score)
    ),
    "Source" = c("IMDB", "Audience", "Critics")
  )
plot_other <- ggplot(mean_score) + geom_linerange(aes(
  x = Source,
  ymin = 0,
  ymax = Score,
  colour = Source
),
position = position_dodge(width = 1)) +  geom_point(
  aes(x = Source, y = Score, colour = Source),
  position = position_dodge(width = 1),
  size = 3
) + coord_flip() + theme(legend.position = "none") + ggtitle("Other")

#Science Fiction & Fantasy
science <- subset(movies, genre == "Science Fiction & Fantasy")

mean_score <-
  data.frame(
    "Score" = c(
      mean(science$imdb_rating)*10,
      mean(science$audience_score),
      mean(science$critics_score)
    ),
    "Source" = c("IMDB", "Audience", "Critics")
  )
plot_science <- ggplot(mean_score) + geom_linerange(aes(
  x = Source,
  ymin = 0,
  ymax = Score,
  colour = Source
),
position = position_dodge(width = 1)) +  geom_point(
  aes(x = Source, y = Score, colour = Source),
  position = position_dodge(width = 1),
  size = 3
) + coord_flip() + theme(legend.position = "none") + ggtitle("Science Fiction & Fantasy")

#Combine the plots...
plot_combined_genre <-
  ggarrange(
    plot_all,
    plot_action,
    plot_animation,
    plot_art_house,
    plot_comedy,
    plot_documentary,
    plot_drama,
    plot_horror,
    plot_mistery,
    plot_musical,
    plot_other,
    plot_science,
    ncol = 3,
    nrow = 4
  )

plot_combined_genre
```

Taking a look at the different lollipop charts, we can see different things:
* Audience gives a higher score than Critics in 10/11 genres (90.9%). The only exception is the Documentary genre.
*  IMDB gives a higher score than Critics in 9/11 genres (81.8%). The only exception is the Documentary and Musical & Performance genres.
* IMDB gives a higher score than Audience in 7/11 genres (63.6%).
* Genres like Documentary and Other receive similar ratings from all IMDB, Critics and Audience, whereas in genres like Comedy or Action & Adventure the ratings differ more.

Taking this into account, we can say that the pattern observed in previously is maintained in the individual genres. Critics give the lowest ratings for almost all genres and IMDB and Audience alternate in giving the highest score. There is a difference in the raitings of the different sources according to the genre and this difference follows a pattern, which is more accentuated in some genres than in others.






## 3. Comparison best picture/oscar nominated and score/oscar nominated
	### - are oscar-awarded films more liked?


```{r}
ggplot(data=movies, aes(x = best_pic_nom, y = audience_score, group = best_pic_nom, fill = best_pic_nom)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies, aes(x = best_actor_win, y = audience_score, group = best_actor_win, fill = best_actor_win)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies, aes(x = best_actress_win, y = audience_score, group = best_actress_win, fill = best_actress_win)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies, aes(x = best_dir_win, y = audience_score, group = best_dir_win, fill = best_dir_win)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()
```

```{r}
ggplot(data=movies, aes(x = best_pic_nom, y = audience_score, group = best_pic_nom, fill = best_pic_nom)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies, aes(x = best_pic_nom, y = critics_score, group = best_pic_nom, fill = best_pic_nom)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies, aes(x = best_pic_nom, y = imdb_rating, group = best_pic_nom, fill = best_pic_nom)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()
```


```{r}
ggplot(aes(x=best_pic_nom), data=movies[movies$best_pic_win=="yes",]) + geom_bar()
movies[movies$best_pic_nom=="no" & movies$best_pic_win=="yes",]
movies[movies$best_pic_nom=="no" & movies$best_pic_win=="yes",]$best_pic_nom <- "yes"
ggplot(aes(x=best_actor_win), data=movies[movies$best_pic_nom=="yes",]) + geom_bar()
ggplot(aes(x=best_actress_win), data=movies[movies$best_pic_nom=="yes",]) + geom_bar()
ggplot(aes(x=best_dir_win), data=movies[movies$best_pic_nom=="yes",]) + geom_bar()
```

```{r}
 best_pic_movies <- subset(movies, c(best_pic_win == "yes"))

 #Add a column showing if they have won another award
 best_pic_movies$other_win <- NA

 if (best_pic_movies$best_actor_win == "yes" ||
     best_pic_movies$best_actress_win == "yes" ||
     best_pic_movies$best_dir_win == "yes") {
   best_pic_movies$other_win <- "yes"
 } else{
    best_pic_movies$other_win <- "no"
 }

 #Plots...
 #Best movies that have won another award
 best_movie_another_award <- plyr::count(best_pic_movies$other_win)
 best_movie_another_award <- best_movie_another_award %>%
   arrange((freq)) %>%
   mutate(lab.ypos = cumsum(freq) - 0.5 * freq)

 pie_another_award <-
   ggplot(best_movie_another_award, aes(x = "", y = freq, fill = x)) +
   geom_bar(width = 1,
            stat = "identity",
            color = "white") +
   coord_polar("y", start = 0) +
   theme_void() +
   geom_text(aes(label = signif((freq / 7) * 100), digits = 2),
             position = position_stack(vjust = 0.5),
             color = "white") +
   labs(fill = "Another award") +
   ggtitle("Best movies with another award") +
   theme(plot.title = element_text(size = 20, hjust = 0.5)) +
   scale_fill_manual(values = "#00BFC4")

 #Best movies that have won best actor award
 best_movie_best_actor <- plyr::count(best_pic_movies$best_actor_win)
 best_movie_best_actor <- best_movie_best_actor %>%
   arrange((freq)) %>%
   mutate(lab.ypos = cumsum(freq) - 0.5 * freq)

 pie_best_actor <-
   ggplot(best_movie_best_actor, aes(x = "", y = freq, fill = x)) +
   geom_bar(width = 1,
            stat = "identity",
            color = "white") +
   coord_polar("y", start = 0) +
   theme_void() +
   geom_text(aes(label = signif((freq / 7) * 100), digits = 2),
             position = position_stack(vjust = 0.5),
             color = "white") +
   labs(fill = "Best actor") +
   ggtitle("Best movies with best actor") +
   theme(plot.title = element_text(size = 20, hjust = 0.5))

 #Best movies that have won best actress award
 best_movie_best_actress <- plyr::count(best_pic_movies$best_actress_win)
 best_movie_best_actress <- best_movie_best_actress %>%
   arrange((freq)) %>%
   mutate(lab.ypos = cumsum(freq) - 1 * freq)

 pie_best_actress <-
   ggplot(best_movie_best_actress, aes(x = "", y = freq, fill = x)) +
   geom_bar(width = 1,
            stat = "identity",
            color = "white") +
   coord_polar("y", start = 0) +
   theme_void() +
   geom_text(aes(label = signif((freq / 7) * 100), digits = 2),
             position = position_stack(vjust = 0.5),
             color = "white") +
   labs(fill = "Best actress") +
   ggtitle("Best movies with best actress") +
   theme(plot.title = element_text(size = 20, hjust = 0.5))

 #Best movies that have won best director award
 best_movie_best_director <- plyr::count(best_pic_movies$best_dir_win)
 best_movie_best_director <- best_movie_best_director %>%
   arrange((freq)) %>%
   mutate(lab.ypos = cumsum(freq) - 0.9 * freq)

 pie_best_director <-
   ggplot(best_movie_best_director, aes(x = "", y = freq, fill = x)) +
   geom_bar(width = 1,
            stat = "identity",
            color = "white") +
   coord_polar("y", start = 0) +
   theme_void() +
   geom_text(aes(label = signif((freq / 7) * 100), digits = 2),
             position = position_stack(vjust = 0.5),
             color = "white") +
   labs(fill = "Best director") +
   ggtitle("Best movies with best director") +
   theme(plot.title = element_text(size = 20, hjust = 0.5))

 #Combine plots!
 plot_combined_awarded <-
   ggarrange(
     pie_another_award,
     pie_best_actor,
    pie_best_actress,
    pie_best_director,
    ncol = 2,
    nrow = 2
  )

plot_combined_awarded
```

Looking at the pie charts, we can see that the movies in the dataset that have received the award for best film always receive another award. The award for best director is present in 6/7 movies, hinting that the quality of the director is mor influent than that of the actors and actresses in determining if the movie is awarded for best film.


```{r}
# -are oscar-awarded films more liked?
#Audience score vs Best_pic_win
plot_audience_vs_best_pic <-
  ggplot(movies,
         aes(x = best_pic_win, y = audience_score, fill = best_pic_win)) + geom_boxplot() + theme(legend.position = "none") + labs(title = "Audience", x = "Best picture award", y = "Score")
#Critics score vs Best_pic_win
plot_critics_vs_best_pic <-
  ggplot(movies,
         aes(x = best_pic_win, y = critics_score, fill = best_pic_win)) + geom_boxplot() + theme(legend.position = "none") + labs(title = "Critics", x = "Best picture award", y = "Score")
#IMDB score vs Best_pic_win
plot_imdb_vs_best_pic <-
  ggplot(movies, aes(x = best_pic_win, y = imdb_rating, fill = best_pic_win)) +
  geom_boxplot() + theme(legend.position = "none") + labs(title = "IMDB", x = "Best picture award", y = "Score")
#Combine the plots...
plot_combined_best_pic <-
  ggarrange(
    plot_audience_vs_best_pic,
    plot_critics_vs_best_pic,
    plot_imdb_vs_best_pic,
    ncol = 3,
    nrow = 1
  )
plot_combined_best_pic

#Audience score vs Best_dir_win
plot_audience_vs_best_dir <-
  ggplot(movies,
         aes(x = best_dir_win, y = audience_score, fill = best_dir_win)) + geom_boxplot() + theme(legend.position = "none") + labs(title = "Audience", x = "Best director award", y = "Score")
#Critics score vs Best_dir_win
plot_critics_vs_best_dir <-
  ggplot(movies,
         aes(x = best_dir_win, y = critics_score, fill = best_dir_win)) + geom_boxplot() + theme(legend.position = "none") + labs(title = "Critics", x = "Best director award", y = "Score")
#IMDB score vs Best_dir_win
plot_imdb_vs_best_dir <-
  ggplot(movies, aes(x = best_dir_win, y = imdb_rating, fill = best_dir_win)) +
  geom_boxplot() + theme(legend.position = "none") + labs(title = "IMDB", x = "Best director award", y = "Score")
#Combine the plots...
plot_combined_best_dir <-
  ggarrange(
    plot_audience_vs_best_dir,
    plot_critics_vs_best_dir,
    plot_imdb_vs_best_dir,
    ncol = 3,
    nrow = 1
  )
plot_combined_best_dir

#Audience score vs Best_actor_win
plot_audience_vs_best_actor <-
  ggplot(movies,
         aes(x = best_actor_win, y = audience_score, fill = best_actor_win)) +
  geom_boxplot() + theme(legend.position = "none") + labs(title = "Audience", x = "Best actor award", y = "Score")
#Critics score vs Best_dir_win
plot_critics_vs_best_actor <-
  ggplot(movies,
         aes(x = best_actor_win, y = critics_score, fill = best_actor_win)) + geom_boxplot() + theme(legend.position = "none") + labs(title = "Critics", x = "Best actor award", y = "Score")
#IMDB score vs Best_dir_win
plot_imdb_vs_best_actor <-
  ggplot(movies,
         aes(x = best_actor_win, y = imdb_rating, fill = best_actor_win)) + geom_boxplot() + theme(legend.position = "none") + labs(title = "IMDB", x = "Best actor award", y = "Score")
#Combine the plots...
plot_combined_best_actor <-
  ggarrange(
    plot_audience_vs_best_actor,
    plot_critics_vs_best_actor,
    plot_imdb_vs_best_actor,
    ncol = 3,
    nrow = 1
  )
plot_combined_best_actor

#Audience score vs Best_actress_win
plot_audience_vs_best_actress <-
  ggplot(movies,
         aes(x = best_actress_win, y = audience_score, fill = best_actress_win)) +
  geom_boxplot() + theme(legend.position = "none") + labs(title = "Audience", x = "Best actress award", y = "Score")
#Critics score vs Best_dir_win
plot_critics_vs_best_actress <-
  ggplot(movies,
         aes(x = best_actress_win, y = critics_score, fill = best_actress_win)) +
  geom_boxplot() + theme(legend.position = "none") + labs(title = "Critics", x = "Best actress award", y = "Score")
#IMDB score vs Best_dir_win
plot_imdb_vs_best_actress <-
  ggplot(movies,
         aes(x = best_actress_win, y = imdb_rating, fill = best_actress_win)) +
  geom_boxplot() + theme(legend.position = "none") + labs(title = "IMDB", x = "Best actress award", y = "Score")
#Combine the plots...
plot_combined_best_actress <-
  ggarrange(
    plot_audience_vs_best_actress,
    plot_critics_vs_best_actress,
    plot_imdb_vs_best_actress,
    ncol = 3,
    nrow = 1
  )
plot_combined_best_actress
```





## 4. What are the trends over the years?
	- Preferred month for releases? number of films by month (over the years? does it affect the score?)
	- Does the genre change over the years?
	- Do older films tend to have higher score/number of votes? if this is true, it could be because only good old films get remembered


> We start to count the movies per months to see if there is a pattern in all this time in the release months.

```{r}
ggplot(movies, aes(fill = thtr_rel_decade)) + geom_bar(aes(x = thtr_rel_month), width = 0.5) + theme_minimal() + xlab("Month") + ylab("# of Films") + ggtitle("Number of Films released per month each decade ") + scale_fill_discrete(name = "Decade", labels=c("70's","80's","90's","00's","10's")) + scale_x_discrete(breaks=1:12,labels=c("Jan", "Feb", "Mar", "Apr","May", "Jun", "Jul", "Aug", "Sept", "Oct", "Nov", "Dec"))
```

> We can see that overall there is a "pattern" of releases in the months of January, June, October and December, so let's take a better look at this data by decade.
> We breakdown the previous graphs grouping the data by decade.

```{r}
ggplot(movies, aes(fill = thtr_rel_decade)) + geom_bar(aes(x = thtr_rel_month), width = 0.5) + facet_wrap(thtr_rel_decade ~ .) + theme_minimal() + xlab("Month") + ylab("# of Films") + ggtitle("Number of Films released per month each decade w/ breakdown") + scale_fill_discrete(name = "Decade", labels=c("70's","80's","90's","00's","10's")) + scale_x_discrete(breaks=1:12,labels=c("Jan", "Feb", "Mar", "Apr","May", "Jun", "Jul", "Aug", "Sept", "Oct", "Nov", "Dec"))
```
> Now we can see clearly that since the 70's there has been a trend of two moments in the years to release movies in theaters: in summer (June) and in the winter Holidays (December and January). However, in this last decade, we only see a spike in December.

### - Does the genre change over the years (by decade)?

```{r}
ggplot(movies, aes(fill = thtr_rel_decade)) + geom_bar(aes(x = genre)) + facet_wrap(thtr_rel_decade ~ .) + theme_minimal() + xlab("Genre") + ylab("# of Films") + ggtitle("Genre of Films released each decade w/ breakdown") + scale_fill_discrete(name = "Decade", labels=c("70's","80's","90's","00's","10's")) + coord_flip()
```

> We can see an increment over the years in the Documentary Genre, as well as in Mystery and Suspense. 

### - Do older films tend to have higher score/number of votes? if this is true, it could be because only good old films get remembered	
	
> Let's see what is the amount of votes over the years that we have for all the films.

```{r}
ggplot(movies, aes(fill = thtr_rel_date)) + geom_smooth(aes(x = thtr_rel_date, y = imdb_num_votes),method = 'loess', formula = 'y ~ x') + geom_point(aes(x = thtr_rel_date, y = imdb_num_votes)) + theme_minimal() + xlab("Date") + ylab("# of Votes") + ylim(min(movies$imdb_num_votes),quantile(movies$imdb_num_votes,.90)) + ggtitle("# of votes rating movies over the years") # + scale_fill_discrete(name = "Decade", labels=c("70's","80's","90's","00's","10's"))
```

> Okay so it seems like the number of votes does increase over the years, but does it afect the overall score?

```{r}
ggplot(movies, aes(fill = thtr_rel_date)) + geom_smooth(aes(x = thtr_rel_date, y = imdb_rating), method = 'loess', formula = 'y ~ x'
) + theme_minimal() + xlab("Date") + ylab("Rating") + ggtitle("Rating of  movies over the years") # + scale_fill_discrete(name = "Decade", labels=c("70's","80's","90's","00's","10's"))
```

> We can clearly see a decrease in overall score of this movies, but we can only asume that the newer the film, the more votes it gets and the worse it performs, but it could be because the quality in filmaking has woesened.


```{r}
ggplot(data=movies, aes(x=thtr_rel_date, y=audience_score)) + geom_point(aes(col=best_pic_nom), size=3)

commonTheme = list(labs(color="Density",fill="Density", x="Date", y="Overall score"))
ggplot(data=movies,aes(thtr_rel_date, audience_score)) + 
  stat_density2d(aes(fill=..level..,alpha=..level..),geom='polygon',colour='black') + 
  scale_fill_continuous(low="green",high="red") +
  guides(alpha="none") +
  commonTheme
```


```{r}
commonTheme = list(labs(color="Density",fill="Density", x="Runtime", y="Overall score"))
ggplot(data=movies,aes(runtime, audience_score)) + 
  stat_density2d(aes(fill=..level..,alpha=..level..),geom='polygon',colour='black') + 
  scale_fill_continuous(low="green",high="red") +
  guides(alpha="none") +
   commonTheme
```


## 5. Do actors and directors have a higher score once they won? (find the first film and see the tendency, look for sudden change)


```{r}
best_dirs =  subset(movies, movies$best_dir_win == "yes") %>%
  group_by(director) %>%
  filter(n() > 2)

win_years = data.frame(
  year = c(2010, 2007,1987, 1990, 1978),
  director=c("Kathryn Bigelow", "Martin Scorsese","Oliver Stone","Oliver Stone","Woody Allen")
)

win_year_intersects = 
  geom_vline(data = win_years, aes(xintercept=year, color = director))

p1 = ggplot(best_dirs, aes(y=critics_score, x=thtr_rel_year, color=director))+
  geom_point()+
  geom_line() +
  win_year_intersects    

p2 = ggplot(best_dirs, aes(y=audience_score, x=thtr_rel_year, color=director))+
  geom_point()+
  geom_line() +
  win_year_intersects

p3= ggplot(best_dirs, aes(y=imdb_rating, x=thtr_rel_year, color=director))+
  geom_point()+
  geom_line() +
  win_year_intersects

grid.arrange(p1, p2, p3, nrow = 3)

```





#Provided questions
##1. What can we say about the relationship between audience scores and at least four of the other variables in this dataset?

### Audience score vs Critics score
```{r}
ggplot(movies, aes(x = audience_score, y = critics_score)) + geom_point() + geom_smooth(method =
                                                                                          lm)
```

### Audience score vs Genre and Audience Score vs Critics Score vs Genre
```{r}
ggplot(movies, aes(
  x = reorder(genre, audience_score, FUN = median),
  y = audience_score,
  fill = genre
)) + geom_boxplot()
ggplot(movies, aes(
  x = reorder(genre, critics_score, FUN = median),
  y = critics_score,
  fill = genre
)) + geom_boxplot()

movies$score_diff <- movies$audience_score - movies$critics_score
ggplot(movies, aes(
  x = reorder(genre, score_diff, FUN = mean),
  y = score_diff,
  fill = genre
)) + geom_boxplot()
```

### Audience score vs Thtre_rel_month
```{r}
ggplot(movies, aes(x = thtr_rel_month)) + geom_histogram(color = "black", fill ="blue")

by_month <- group_by(movies, thtr_rel_month)
by_month_mean_score<-summarise(by_month, audience=mean(audience_score))
plot(x=by_month_mean_score$thtr_rel_month,y=by_month_mean_score$audience)
```
###Audience score vs Best_pic_win
```{r}
ggplot(movies,
       aes(x = best_pic_win, y = audience_score, fill = best_pic_win)) + geom_boxplot()
```


### Audience score vs Best_dir_win
```{r}
ggplot(movies,
       aes(x = best_dir_win, y = audience_score, fill = best_dir_win)) + geom_boxplot()
```

### Audience score vs Best_actor_win/Best_actress_win
```{r}
ggplot(movies,
       aes(x = best_actor_win, y = audience_score, fill = best_actor_win)) +
  geom_boxplot()
ggplot(movies,
       aes(x = best_actress_win, y = audience_score, fill = best_actress_win)) +
  geom_boxplot()
```


## 2. Is there a difference in the score given by audience members (or critics) for movies of different genres? And for movies with different MPAA ratings? If so, which categories seem to be significantly different for each other?
```{r}
ggplot(movies, aes(
  x = reorder(genre, audience_score, FUN = median),
  y = audience_score,
  fill = genre
)) + geom_boxplot()
ggplot(movies, aes(
  x = reorder(genre, critics_score, FUN = median),
  y = critics_score,
  fill = genre
)) + geom_boxplot()

ggplot(movies, aes(
  x = reorder(mpaa_rating, audience_score, FUN = median),
  y = audience_score,
  fill = mpaa_rating
)) + geom_boxplot()
ggplot(movies, aes(
  x = reorder(mpaa_rating, critics_score, FUN = median),
  y = critics_score,
  fill = mpaa_rating
)) + geom_boxplot()
```
