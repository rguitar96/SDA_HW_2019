---
title: "R Notebook"
output: html_notebook
---

```{r}
library(ggplot2)
```

> We load the data and give a quick look at the header

```{r}
movies <- get(load("movies.RData"))
```
```{r}
head(movies)
```

> Looking for NAN values

```{r}
movies[!complete.cases(movies['runtime']),]
```

> We can find the runtime of the movie "The End of America" in Google, which is 74 minutes.

```{r}
movies$runtime[movies$title == "The End of America"] <- 74
```

```{r}
movies[!complete.cases(movies['director']),]
```

> We can find the missing directors as well.

```{r}
movies$director[movies$title == "Lorenzo's Oil"] <- "George Miller"
movies$director[movies$title == "The Ninth Gate"] <- "Roman Polanski"
```


```{r}
movies[!complete.cases(movies["studio"]),]
```

> It seems that there are 8 films without a studio associated

```{r}
movies[!complete.cases(movies["dvd_rel_year"]),]
```

> And 8 films withouth a DVD

```{r}
movies[!complete.cases(movies["actor5"]),]
```

> And 15 films without one or more of the five main actors.

> Lets remove columns and add them up!

```{r}
movies$thtr_rel_date <- as.Date(paste0(movies$thtr_rel_year, "-", movies$thtr_rel_month, "-", movies$thtr_rel_day))
movies$dvd_rel_date <- as.Date(paste0(movies$dvd_rel_year, "-", movies$dvd_rel_month, "-", movies$dvd_rel_day))

movies$dvd_rel_day <- NULL
movies$dvd_rel_month <- NULL
movies$dvd_rel_year <- NULL

movies$thtr_rel_day <- NULL
movies$thtr_rel_month <- NULL
movies$thtr_rel_year <- NULL

movies$imdb_url <- NULL
movies$rt_url <- NULL
```

> Cleaner!

```{r}
head(movies)
```


> Now, some very basic visualization!

```{r}
hist(movies$audience_score)
ggplot(movies, aes(x=audience_score)) + geom_histogram()
ggplot(movies, aes(x=critics_score)) + geom_histogram()
ggplot(movies, aes(x=imdb_rating)) + geom_histogram()
ggplot(movies, aes(x=thtr_rel_date)) + geom_histogram()
ggplot(movies, aes(x=imdb_num_votes)) + geom_histogram()
ggplot(movies, aes(x=log10(imdb_num_votes))) + geom_histogram()
```
```{r}
ggplot(aes(x=forcats::fct_infreq(title_type)), data=movies) + geom_bar()
ggplot(aes(x=forcats::fct_infreq(genre)), data=movies) + geom_bar()
ggplot(aes(x=forcats::fct_infreq(mpaa_rating)), data=movies) + geom_bar()
ggplot(aes(x=forcats::fct_infreq(critics_rating)), data=movies) + geom_bar()
ggplot(aes(x=forcats::fct_infreq(audience_rating)), data=movies) + geom_bar()
```

> Some continuous plotting:

```{r}
ggplot(data=movies, aes(x=audience_score, y=critics_score)) + geom_point() + geom_smooth(method='lm')
ggplot(data=movies, aes(x=audience_score, y=imdb_rating)) + geom_point() + geom_smooth(method='lm')
ggplot(data=movies, aes(x=critics_score, y=imdb_rating)) + geom_point() + geom_smooth(method='lm')
```


```{r}
ggplot(data=movies, aes(x=audience_score, y=critics_score)) + geom_point(aes(col=title_type), size=3) + geom_smooth(method='lm')
ggplot(data=movies, aes(x=audience_score, y=critics_score)) + geom_point(aes(col=genre), size=3) + geom_smooth(method='lm')
```

```{r}
ggplot(data=subset(movies, genre == "Action & Adventure"), aes(x=audience_score, y=critics_score)) + geom_point(aes(col=title_type), size=3)

ggplot(data=subset(movies, genre == "Animation"), aes(x=audience_score, y=critics_score)) + geom_point(aes(col=title_type), size=3)

ggplot(data=subset(movies, genre == "Art House & International"), aes(x=audience_score, y=critics_score)) + geom_point(aes(col=title_type), size=3)

ggplot(data=subset(movies, genre == "Comedy"), aes(x=audience_score, y=critics_score)) + geom_point(aes(col=title_type), size=3)

ggplot(data=subset(movies, genre == "Documentary"), aes(x=audience_score, y=critics_score)) + geom_point(aes(col=title_type), size=3)

ggplot(data=subset(movies, genre == "Drama"), aes(x=audience_score, y=critics_score)) + geom_point(aes(col=title_type), size=3)

ggplot(data=subset(movies, genre == "Horror"), aes(x=audience_score, y=critics_score)) + geom_point(aes(col=title_type), size=3)

ggplot(data=subset(movies, genre == "Musical & Performing Arts"), aes(x=audience_score, y=critics_score)) + geom_point(aes(col=title_type), size=3)

ggplot(data=subset(movies, genre == "Mystery & Suspense"), aes(x=audience_score, y=critics_score)) + geom_point(aes(col=title_type), size=3)

ggplot(data=subset(movies, genre == "Other"), aes(x=audience_score, y=critics_score)) + geom_point(aes(col=title_type), size=3)

ggplot(data=subset(movies, genre == "Science Fiction & Fantasy"), aes(x=audience_score, y=critics_score)) + geom_point(aes(col=title_type), size=3)
```


```{r}
nrow(movies[movies$best_pic_win == "yes" | movies$best_actor_win == "yes" | movies$best_actress_win == "yes" | movies$best_dir_win == "yes",])
nrow(movies)
```

> Are oscar-awarded films more liked?

```{r}
ggplot(data=movies[movies$best_pic_win == "yes" | movies$best_actor_win == "yes" | movies$best_actress_win == "yes" | movies$best_dir_win == "yes",],
       aes(x=audience_score, y=critics_score)) + geom_point() + geom_smooth(method='lm')
ggplot(data=movies, aes(x=audience_score, y=critics_score)) + geom_point() + geom_smooth(method='lm')
```

> It seems that not really


> 1-Is there a relationship between the type/genre and score?

```{r}
ggplot(data=movies, aes(x=audience_score)) + geom_histogram(bins=30, aes(color = title_type), position = "identity", alpha = 0.7) + scale_color_manual(values = c("#00AFBB", "#E7B800", "#0AFBB0")) + scale_fill_manual(values = c("#00AFBB", "#E7B800", "#0AFBB0"))
ggplot(data=movies, aes(x=audience_score)) + geom_density(aes(color = title_type), kernel = "gaussian")
```

> It seems that Documentaries are very highly rated by the audience. Feature Films are more evenly distributed, and so are TV Movies (though there are not many samples)

```{r}
ggplot(data=movies, aes(x=critics_score)) + geom_histogram(bins=30, aes(color = title_type), position = "identity", alpha = 0.7) + scale_color_manual(values = c("#00AFBB", "#E7B800", "#0AFBB0")) + scale_fill_manual(values = c("#00AFBB", "#E7B800", "#0AFBB0"))
ggplot(data=movies, aes(x=critics_score)) + geom_density(aes(color = title_type), kernel = "gaussian")
```


> This phenomenom is even more accentuated when we take into account the rating of critics.

```{r}
ggplot(data=movies, aes(x=imdb_rating)) + geom_histogram(bins=30, aes(color = title_type), position = "identity", alpha = 0.7) + scale_color_manual(values = c("#00AFBB", "#E7B800", "#0AFBB0")) + scale_fill_manual(values = c("#00AFBB", "#E7B800", "#0AFBB0"))
ggplot(data=movies, aes(x=imdb_rating)) + geom_density(aes(color = title_type), kernel = "gaussian")
```

> When we take into account the imdb ratings, Feature Films get, in general, higher scores, and it seems like a more simmetrical normal distribution.

```{r}
ggplot(data=movies, aes(x = forcats::fct_infreq(genre), y = audience_score, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()
ggplot(data=movies, aes(x = reorder(genre, audience_score, median, order=TRUE), y = audience_score, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()
```

```{r}
ggplot(data=movies, aes(x = forcats::fct_infreq(genre), y = critics_score, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()
ggplot(data=movies, aes(x = reorder(genre, critics_score, median, order=TRUE), y = audience_score, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()
```

```{r}
ggplot(data=movies, aes(x = forcats::fct_infreq(genre), y = imdb_rating, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()
ggplot(data=movies, aes(x = reorder(genre, imdb_rating, median, order=TRUE), y = audience_score, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()
```

> Apart from Documentaries, and Music films, would you say there are genres more liked than others?



> 3-Comparison best picture/oscar wins and score/oscar wins. Are oscar-awarded films more liked?


```{r}
ggplot(data=movies, aes(x = best_pic_nom, y = audience_score, group = best_pic_nom, fill = best_pic_nom)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies, aes(x = best_actor_win, y = audience_score, group = best_actor_win, fill = best_actor_win)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies, aes(x = best_actress_win, y = audience_score, group = best_actress_win, fill = best_actress_win)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies, aes(x = best_dir_win, y = audience_score, group = best_dir_win, fill = best_dir_win)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies, aes(x = best_dir_win, y = audience_score, group = best_dir_win, fill = best_dir_win)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()
```

> It seems that best actress and best director awarded films tend to have sighly higher scores overall. While best actor does not seem to be related to the score, there is a huge positive relationship between best picture awared films and the overall score.

```{r}
ggplot(data=movies, aes(x = best_pic_nom, y = audience_score, group = best_pic_nom, fill = best_pic_nom)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies, aes(x = best_pic_nom, y = critics_score, group = best_pic_nom, fill = best_pic_nom)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies, aes(x = best_pic_nom, y = imdb_rating, group = best_pic_nom, fill = best_pic_nom)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()
```

> As movies that have won the best picture oscar are only 7, we should use the pictures that have been nominated (even if they are still only 22)

```{r}
ggplot(aes(x=best_pic_nom), data=movies[movies$best_pic_win=="yes",]) + geom_bar()
```

> There seems to be a film that has been tagged as Oscar awarded but not nominated, let's check it and correct it.

```{r}
movies[movies$best_pic_nom=="no" & movies$best_pic_win=="yes",]
```

```{r}
movies[movies$best_pic_nom=="no" & movies$best_pic_win=="yes",]$best_pic_nom <- "yes"
```

```{r}
ggplot(aes(x=best_actor_win), data=movies[movies$best_pic_nom=="yes",]) + geom_bar()
ggplot(aes(x=best_actress_win), data=movies[movies$best_pic_nom=="yes",]) + geom_bar()
ggplot(aes(x=best_dir_win), data=movies[movies$best_pic_nom=="yes",]) + geom_bar()
```

> To the original question, it seems that best picture awarded films are in general more liked.

> 4-What are the trends over the years?
>	-Preferred month for releases? number of films by month (over the years? does it affect the score?)
>	-Does the genre change over the years?
>	-Do older films tend to have higher score/number of votes? if this is true, it could be because only good old films get remembered


```{r}
ggplot(movies, aes(x=thtr_rel_date)) + geom_histogram()
```

> We will group the films by decade.

```{r}
movies$thtr_rel_decade <- as.numeric(format(movies$thtr_rel_date,"%Y")) - (as.numeric(format(movies$thtr_rel_date,"%Y")) %% 10)
```


```{r}
ggplot(data=movies, aes(x = thtr_rel_decade, y = audience_score, group = thtr_rel_decade, fill = thtr_rel_decade)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies, aes(x = thtr_rel_date, y = audience_score, group = thtr_rel_decade, fill = thtr_rel_decade)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()
```

> Mean score has sigly gone down. I would say there is a lack of old bad films, as there is a lack of points in the bottom-left corner.

```{r}
library(lubridate)
```



```{r}
ggplot(movies[movies$thtr_rel_decade==1970,], aes(as.factor(month(thtr_rel_date)))) + 
geom_bar(position='dodge') + xlab("Date") + ylab("Count")
ggplot(movies[movies$thtr_rel_decade==1980,], aes(as.factor(month(thtr_rel_date)))) + 
geom_bar(position='dodge') + xlab("Date") + ylab("Count")
ggplot(movies[movies$thtr_rel_decade==1990,], aes(as.factor(month(thtr_rel_date)))) + 
geom_bar(position='dodge') + xlab("Date") + ylab("Count")
ggplot(movies[movies$thtr_rel_decade==2000,], aes(as.factor(month(thtr_rel_date)))) + 
geom_bar(position='dodge') + xlab("Date") + ylab("Count")
ggplot(movies[movies$thtr_rel_decade==2010,], aes(as.factor(month(thtr_rel_date)))) + 
geom_bar(position='dodge') + xlab("Date") + ylab("Count")
```

> We coul argue that there used to be a pattern in the month release (in the 70's the preferred release was clearly on Christmas, and there is another peak on summer). This pattern evolves in time and gets lost.

```{r}
ggplot(data=movies, aes(x = as.factor(month(thtr_rel_date)), y = audience_score, group = as.factor(month(thtr_rel_date)), fill = as.factor(month(thtr_rel_date)))) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()
```

> There  seems to be no tendency to rate higher on certain months.

```{r}
ggplot(data=movies, aes(x=thtr_rel_date, y=audience_score)) + geom_point(aes(col=best_pic_nom), size=3)

commonTheme = list(labs(color="Density",fill="Density", x="Date", y="Overall score"))
ggplot(data=movies,aes(thtr_rel_date, audience_score)) + 
  stat_density2d(aes(fill=..level..,alpha=..level..),geom='polygon',colour='black') + 
  scale_fill_continuous(low="green",high="red") +
  guides(alpha="none") +
  geom_point() + commonTheme
```


```{r}
ggplot(data=movies[movies$thtr_rel_decade==1970,], aes(x = reorder(genre, audience_score, median, order=TRUE), y = audience_score, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies[movies$thtr_rel_decade==1980,], aes(x = reorder(genre, audience_score, median, order=TRUE), y = audience_score, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies[movies$thtr_rel_decade==1990,], aes(x = reorder(genre, audience_score, median, order=TRUE), y = audience_score, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies[movies$thtr_rel_decade==2000,], aes(x = reorder(genre, audience_score, median, order=TRUE), y = audience_score, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()

ggplot(data=movies[movies$thtr_rel_decade==2010,], aes(x = reorder(genre, audience_score, median, order=TRUE), y = audience_score, group = genre, fill = genre)) + geom_boxplot(alpha = .7) + geom_jitter(width = .05, alpha = .4) + guides(fill = "none") + theme_bw()
```


> Too little data, but we can see that Documentaries remain on the top over the years, and Musicals arise in the 90's

